<!DOCTYPE html>
<html>
<head>
    <title>Authentication Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .container { max-width: 600px; background: white; padding: 20px; border-radius: 8px; }
        .button { 
            background: #007acc; color: white; border: none; padding: 10px 20px; 
            margin: 10px 0; border-radius: 5px; cursor: pointer; font-size: 16px; display: block;
        }
        .input { 
            width: 100%; padding: 10px; margin: 5px 0; border: 1px solid #ddd; 
            border-radius: 4px; font-size: 16px;
        }
        .success { background: #d4edda; padding: 15px; margin: 10px 0; border-radius: 5px; color: #155724; }
        .error { background: #f8d7da; padding: 15px; margin: 10px 0; border-radius: 5px; color: #721c24; }
        .log { background: #f8f8f8; padding: 10px; height: 200px; overflow-y: scroll; font-family: monospace; font-size: 12px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîê Authentication Test</h1>
        
        <h2>Test Registration</h2>
        <input id="org-name" class="input" placeholder="Organization Name" value="Test Org 2">
        <input id="first-name" class="input" placeholder="First Name" value="John">
        <input id="last-name" class="input" placeholder="Last Name" value="Doe">
        <input id="reg-email" class="input" placeholder="Email" value="test2@test.com">
        <input id="reg-password" class="input" type="password" placeholder="Password" value="password123">
        <button class="button" onclick="testRegistration()">Test Registration</button>
        
        <h2>Test Login</h2>
        <input id="login-email" class="input" placeholder="Email" value="test@test.com">
        <input id="login-password" class="input" type="password" placeholder="Password" value="password123">
        <button class="button" onclick="testLogin()">Test Login</button>
        
        <button class="button" onclick="testApiConnection()">Test API Connection</button>
        
        <div id="result"></div>
        
        <h3>Logs</h3>
        <div id="logs" class="log"></div>
    </div>

    <script>
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            const logElement = document.getElementById('logs');
            logElement.innerHTML += `[${timestamp}] ${message}<br>`;
            logElement.scrollTop = logElement.scrollHeight;
            console.log(`[${timestamp}] ${message}`);
        }
        
        function showResult(message, isError = false) {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = `<div class="${isError ? 'error' : 'success'}">${message}</div>`;
        }
        
        async function testApiConnection() {
            log('üß™ Testing API connection...');
            try {
                const response = await fetch('http://localhost:3001/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        email: 'nonexistent@test.com',
                        password: 'wrong'
                    })
                });
                
                const data = await response.json();
                log('‚úÖ API connection successful');
                log('Response: ' + JSON.stringify(data));
                showResult('‚úÖ API connection working! Backend is reachable.');
            } catch (error) {
                log('‚ùå API connection failed: ' + error.message);
                showResult('‚ùå API connection failed: ' + error.message, true);
            }
        }
        
        async function testRegistration() {
            const orgName = document.getElementById('org-name').value;
            const firstName = document.getElementById('first-name').value;
            const lastName = document.getElementById('last-name').value;
            const email = document.getElementById('reg-email').value;
            const password = document.getElementById('reg-password').value;
            
            log('üß™ Testing registration...');
            log('Data: ' + JSON.stringify({ orgName, firstName, lastName, email }));
            
            try {
                const response = await fetch('http://localhost:3001/api/auth/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        organizationName: orgName,
                        firstName,
                        lastName,
                        email,
                        password
                    })
                });
                
                const data = await response.json();
                log('Response status: ' + response.status);
                log('Response data: ' + JSON.stringify(data));
                
                if (response.ok) {
                    showResult('‚úÖ Registration successful! Token: ' + data.token.substring(0, 20) + '...');
                    localStorage.setItem('token', data.token);
                    localStorage.setItem('user', JSON.stringify(data.user));
                } else {
                    showResult('‚ùå Registration failed: ' + data.error, true);
                }
            } catch (error) {
                log('‚ùå Registration error: ' + error.message);
                showResult('‚ùå Registration failed: ' + error.message, true);
            }
        }
        
        async function testLogin() {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            log('üß™ Testing login...');
            log('Email: ' + email);
            
            try {
                const response = await fetch('http://localhost:3001/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        email,
                        password
                    })
                });
                
                const data = await response.json();
                log('Response status: ' + response.status);
                log('Response data: ' + JSON.stringify(data));
                
                if (response.ok) {
                    showResult('‚úÖ Login successful! Token: ' + data.token.substring(0, 20) + '...');
                    localStorage.setItem('token', data.token);
                    localStorage.setItem('user', JSON.stringify(data.user));
                } else {
                    showResult('‚ùå Login failed: ' + data.error, true);
                }
            } catch (error) {
                log('‚ùå Login error: ' + error.message);
                showResult('‚ùå Login failed: ' + error.message, true);
            }
        }
        
        // Initialize
        log('üöÄ Auth test page loaded');
        log('Current URL: ' + window.location.href);
        
        // Test API connection on load
        setTimeout(testApiConnection, 1000);
    </script>
</body>
</html>